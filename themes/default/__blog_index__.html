<!-- sidebar: blog index -->
<script>
    window.gs_status.current_blog_uri = null;
    window.gs_status.current_blog_version = 0;

    function gs_current_pathname() {
        let p = location.pathname;
        if (p.endsWith('/')) {
            p = p + 'index.html';
        }
        return p;
    }

    function gs_set_loading() {
        document.getElementById('gsi-content').innerHTML = `<div class="block w-5 h-5">
<svg class="animate-spin -ml-1 mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
</svg></div>`;
        window.scrollTo({ top: 0 });
    }

    function gs_set_current_blog_uri(uri) {
        const old_uri = window.gs_status.current_blog_uri;
        console.log(`set chapter: ${old_uri} => ${uri}`);
        if (old_uri) {
            // dynamic load part of page:
            document.querySelector(`#gsi-index a[href="{{ site.rootPath }}${old_uri}"]`).classList.remove('gsc-active');
        }
        const a = document.querySelector(`#gsi-index a[href="{{ site.rootPath }}${uri}"]`);
        a.classList.add('gsc-active');
        // set new current uri:
        window.gs_status.current_blog_uri = uri;
        // scroll into view if first loaded:
        if (!old_uri) {
            a.parentNode.scrollIntoView && a.parentNode.scrollIntoView(true);
        }
    }

    function gs_load_blog(uri, shouldPushState) {
        if (uri === window.gs_status.current_blog_uri) {
            return;
        }
        gs_set_current_blog_uri(uri);
        if (shouldPushState) {
            console.log(`push state: ${uri}`);
            history.pushState({}, '', `{{ site.rootPath }}${uri}`);
        }
        console.log(`try load new chapter: ${uri}`);
        if (window.gs_status.show_offcanvas) {
            gitsite.hideOffcanvas();
        }
        gs_set_loading();
        window.gs_status.current_blog_version++;
        const version = window.gs_status.current_blog_version;
        gs_load_blog_content(uri).then((html) => {
            if (version === window.gs_status.current_blog_version) {
                console.log(`loaded ok: ${uri}`);
                gitsite.setInnerHTML(document.querySelector('#gsi-content'), html);
                document.title = document.querySelector('#gsi-blog-title h1').innerHTML + ' - ' + window.gs_status.title_suffix;
                gitsite.triggerContentChangedListener();
            }
        }).catch(err => {
            console.error(err);
        });
    }

    async function gs_load_blog_content(uri) {
        // load /blogs/<uri>/content.html:
        let chapter_uri = uri.substring(0, uri.length - 'index.html'.length) + 'content.html';
        let resp = await fetch(`{{ site.rootPath }}${chapter_uri}`);
        if (resp.status === 200) {
            return await resp.text();
        }
    }
</script>

<div id="gsi-index">
    <div id="gsi-sidebar-tools" class="mb-4">
        <div class="flex items-center space-x-3">
            <!-- search icon -->
            <a class="inline-block py-1 px-2 rounded" href="#0" onclick="gitsite.showSearch();return false;" title="Search">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="inline-block w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                </svg>
            </a>
            <!-- light/dark mode toggles -->
            <a class="inline-block py-1 px-2 rounded gsc-hidden-on-dark" href="#0" onclick="gitsite.setDarkMode(true);return false;" title="Switch to dark mode">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="inline-block w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
                </svg>
            </a>
            <a class="inline-block py-1 px-2 rounded gsc-hidden-on-light" href="#0" onclick="gitsite.setDarkMode(false);return false;" title="Switch to light mode">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="inline-block w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
                </svg>
            </a>
            <!-- homepage link icon -->
            <a class="inline-block py-1 px-2 rounded" href="{{ site.contact.homepage }}" target="_blank" rel="noopener noreferrer" title="Homepage">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="inline-block w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955a1 1 0 011.591 0L21.75 12" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75" />
                </svg>
            </a>
        </div>
    </div>
    {% for blog in blogs %}
    <div class="gsc-index-item">
        <div class="pt-4">
            <span class="pl-1 text-sm font-semibold uppercase">
                <time datetime="{{ blog.date }}"></time>
            </span>
        </div>
        <a href="{{ site.rootPath }}/blogs/{{ blog.uri }}/index.html"
            onclick="gs_load_blog('/blogs/{{ blog.uri }}/index.html',true);return false;">
            <span class="gsc-index-item-title">{{ blog.title }}</span>
        </a>
        <div class="pb-4"></div>
    </div>
    {% endfor %}
</div>
<script>
    Array.from(document.querySelectorAll('#gsi-index time')).forEach(dom => {
        dom.innerHTML = new Date(dom.getAttribute('datetime')).toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' });
    });

    gs_set_current_blog_uri(gs_current_pathname().substring('{{ site.rootPath }}'.length));
    window.onpopstate = function (e) {
        console.log(`pop state: ${gs_current_pathname()}`);
        gs_load_blog(gs_current_pathname().substring('{{ site.rootPath }}'.length));
    }
</script>
<!--// sidebar: blog index -->